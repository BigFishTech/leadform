<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SolarBright – Multi-Step Solar Consultation</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Express Consent Snapshot Script (local dev) -->
    <script src="http://127.0.0.1:5050/express-consent-script.bundle.js/?cid=QidqO2mithH2MqetCkqm"></script>
  </head>
  <body
    class="bg-gradient-to-b from-blue-50 to-green-100 min-h-screen flex items-start justify-center py-10 px-4"
  >
    <div class="w-full max-w-2xl">
      <!-- Progress Bar -->
      <div class="flex justify-between mb-8">
        <div class="flex-1 mr-2 h-2 rounded-full bg-gray-200">
          <div
            id="bar-1"
            class="h-full rounded-full bg-blue-600 transition-all"
            style="width: 33%"
          ></div>
        </div>
        <div class="flex-1 mx-2 h-2 rounded-full bg-gray-200">
          <div
            id="bar-2"
            class="h-full rounded-full bg-blue-600 transition-all"
            style="width: 0%"
          ></div>
        </div>
        <div class="flex-1 ml-2 h-2 rounded-full bg-gray-200">
          <div
            id="bar-3"
            class="h-full rounded-full bg-blue-600 transition-all"
            style="width: 0%"
          ></div>
        </div>
      </div>

      <!-- STEP 1 – CONTACT INFO -->
      <section id="step-1" class="bg-white rounded-2xl shadow-lg p-8">
        <h2 class="text-2xl font-bold text-center text-blue-800 mb-6">
          Step 1: Contact Information
        </h2>
        <form id="form-step-1" class="space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label
                for="firstName"
                class="block text-sm font-medium text-gray-700 mb-1"
                >First Name</label
              >
              <input
                type="text"
                id="firstName"
                name="firstName"
                required
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
            <div>
              <label
                for="lastName"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Last Name</label
              >
              <input
                type="text"
                id="lastName"
                name="lastName"
                required
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
          </div>
          <div>
            <label
              for="email"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Email</label
            >
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
          <div>
            <label
              for="phone"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Phone</label
            >
            <input
              type="tel"
              id="phone"
              name="phone"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          <!-- Checkbox unique to step 1 -->
          <div class="flex items-start">
            <input
              id="tcpa-step1"
              name="tcpaStep1"
              type="checkbox"
              required
              class="h-4 w-4 mt-1 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
            />
            <label for="tcpa-step1" class="ml-2 text-sm text-gray-700">
              I agree to receive marketing communications regarding solar
              products.
            </label>
          </div>

          <button
            type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg"
          >
            Next
          </button>
        </form>
      </section>

      <!-- STEP 2 – PROPERTY DETAILS -->
      <section id="step-2" class="bg-white rounded-2xl shadow-lg p-8 hidden">
        <h2 class="text-2xl font-bold text-center text-blue-800 mb-6">
          Step 2: Property Details
        </h2>
        <form id="form-step-2" class="space-y-4">
          <div>
            <label
              for="address"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Home Address</label
            >
            <input
              type="text"
              id="address"
              name="address"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
          <div>
            <label
              for="homeowner"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Are you a homeowner?</label
            >
            <select
              id="homeowner"
              name="homeowner"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="" disabled selected>Select</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </div>
          <div>
            <label
              for="roofType"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Roof Type</label
            >
            <select
              id="roofType"
              name="roofType"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="" disabled selected>Select</option>
              <option value="shingle">Shingle</option>
              <option value="tile">Tile</option>
              <option value="metal">Metal</option>
              <option value="flat">Flat</option>
            </select>
          </div>

          <!-- Checkbox unique to step 2 -->
          <div class="flex items-start">
            <input
              id="survey-consent"
              name="surveyConsent"
              type="checkbox"
              required
              class="h-4 w-4 mt-1 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
            />
            <label for="survey-consent" class="ml-2 text-sm text-gray-700">
              I consent to a preliminary roof inspection by SolarBright.
            </label>
          </div>

          <button
            type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg"
          >
            Next
          </button>
        </form>
      </section>

      <!-- STEP 3 – ENERGY USAGE -->
      <section id="step-3" class="bg-white rounded-2xl shadow-lg p-8 hidden">
        <h2 class="text-2xl font-bold text-center text-blue-800 mb-6">
          Step 3: Energy Usage
        </h2>
        <form id="form-step-3" class="space-y-4">
          <div>
            <label
              for="electricBill"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Average Monthly Electric Bill</label
            >
            <select
              id="electricBill"
              name="electricBill"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="" disabled selected>Select</option>
              <option value="0-100">$0 – $100</option>
              <option value="101-200">$101 – $200</option>
              <option value="201-300">$201 – $300</option>
              <option value="301+">$301+</option>
            </select>
          </div>
          <div>
            <label
              for="powerCompany"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Current Power Company</label
            >
            <input
              type="text"
              id="powerCompany"
              name="powerCompany"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          <!-- Checkbox unique to step 3 -->
          <div class="flex items-start">
            <input
              id="final-consent"
              name="finalConsent"
              type="checkbox"
              required
              class="h-4 w-4 mt-1 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
            />
            <label for="final-consent" class="ml-2 text-sm text-gray-700">
              I confirm the information provided is accurate to the best of my
              knowledge.
            </label>
          </div>

          <button
            type="submit"
            class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg"
          >
            Submit & Finish
          </button>
        </form>
      </section>

      <!-- THANK-YOU POPUP -->
      <div
        id="thankYouPopup"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
      >
        <div class="bg-white rounded-lg p-8 max-w-md text-center">
          <svg
            class="w-16 h-16 text-green-500 mx-auto mb-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5 13l4 4L19 7"
            ></path>
          </svg>
          <h2 class="text-2xl font-bold text-gray-800 mb-2">Thank You!</h2>
          <p class="text-gray-600 mb-6">
            A solar expert will contact you within 24 hours to discuss your
            custom quote.
          </p>
          <button
            id="closePopup"
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <script>
      /* Utility to move between steps */
      function showStep(current, next) {
        document.getElementById(`step-${current}`).classList.add("hidden");
        document.getElementById(`step-${next}`).classList.remove("hidden");
        // Update progress bar widths
        document.getElementById(`bar-${current}`).style.width = "100%";
        if (next <= 3) {
          document.getElementById(`bar-${next}`).style.width = "33%";
        }
      }

      /* --- STEP 1 --- */
      document
        .getElementById("form-step-1")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          try {
            const txId = await SnapshotTool.captureAndUpload(
              {
                step: 1,
                firstName: document.getElementById("firstName").value,
                lastName: document.getElementById("lastName").value,
                email: document.getElementById("email").value,
                phone: document.getElementById("phone").value,
                tcpaConsent: document.getElementById("tcpa-step1").checked,
              },
              ["ab12"]
            );
            console.log("Step 1 transaction:", txId);
            showStep(1, 2);
          } catch (err) {
            console.error("Step 1 error:", err);
          }
        });

      /* --- STEP 2 --- */
      document
        .getElementById("form-step-2")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          try {
            const txId = await SnapshotTool.captureAndUpload({
              step: 2,
              address: document.getElementById("address").value,
              homeowner: document.getElementById("homeowner").value,
              roofType: document.getElementById("roofType").value,
              surveyConsent: document.getElementById("survey-consent").checked,
            });
            console.log("Step 2 transaction:", txId);
            showStep(2, 3);
          } catch (err) {
            console.error("Step 2 error:", err);
          }
        });

      /* --- STEP 3 --- */
      document
        .getElementById("form-step-3")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          try {
            const txId = await SnapshotTool.captureAndUpload(
              {
                step: 3,
                electricBill: document.getElementById("electricBill").value,
                powerCompany: document.getElementById("powerCompany").value,
                finalConsent: document.getElementById("final-consent").checked,
              },
              ["ab12"]
            );
            console.log("Step 3 transaction:", txId);
            // Show thank-you popup & reset all forms
            document.getElementById("thankYouPopup").classList.remove("hidden");
            document.getElementById("form-step-1").reset();
            document.getElementById("form-step-2").reset();
            document.getElementById("form-step-3").reset();
            showStep(3, 1); // Reset to first step for next lead
            // Reset progress bars
            document
              .querySelectorAll('[id^="bar-"]')
              .forEach((bar) => (bar.style.width = "0%"));
            document.getElementById("bar-1").style.width = "33%";
          } catch (err) {
            console.error("Step 3 error:", err);
          }
        });

      /* Close the thank-you popup */
      document
        .getElementById("closePopup")
        .addEventListener("click", function () {
          document.getElementById("thankYouPopup").classList.add("hidden");
        });
    </script>
  </body>
</html>
